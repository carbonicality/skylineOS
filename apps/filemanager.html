<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>SkylineOS</title>
        <style>
            @font-face {
                font-family: 'terminus';
                src: url('../fonts/terminus-reg.ttf');
                font-weight: normal;
                font-style: normal;
            }

            @font-face {
                font-family: 'terminus-bold';
                src: url('../fonts/terminus-bold.ttf');
                font-weight: normal;
                font-style: normal;
            }  

            @font-face {
                font-family: 'terminus-ital';
                src: url('../fonts/terminus-ital.ttf');
                font-weight: normal;
                font-style: normal;
            }

            @font-face {
                font-family: 'terminus-bold-ital';
                src: url('../fonts/terminus-bold-ital.ttf');
                font-weight: normal;
                font-style: normal;
            }
            @font-face {
                font-family: 'tamzen-bold';
                src: url('../fonts/tamzen-bold.ttf');
                font-weight: normal;
                font-style: normal;
            }

            @font-face {
                font-family: 'spleen-bold';
                src: url('../fonts/spleen_bold.otf');
                font-weight: normal;
                font-style: normal;
            }

            @font-face {
                font-family: 'unifont';
                src: url('../fonts/unifont.ttf');
                font-weight: normal;
                font-style: normal;
            }

            body {
                font-family: 'terminus';
                color: white;
                font-size: 18px;
                background-color: #272727;
                height: 100vh;
                margin: 0;
                display: flex;
                flex-direction: column;
            }

            .main-content {
                display: flex;
                flex: 1;
                overflow: hidden;
                padding: 0 5px 5px 5px;
            }

            .header-sec {
                flex-shrink: 0;
            }

            .main-area {
                flex: 1;
                background-color: #272727;
            }

            .selector-bar {
                width: calc(100% - 10px);
                height: 30px;
                margin: 5px;
                margin-bottom: 0;
                border: 1.5px solid #1f1f1f;
                align-items: center;
                display: flex;
            }

            .selector-btn {
                background-color: transparent;
                font-family: 'unifont';
                color: white;
                margin-left: 5px;
                margin-right: 2.5px;
                border: none;
                font-size: 15px;
            }

            .divider {
                height: 20px;
                width: 1.5px;
                background-color: #1f1f1f;
                margin-right: 5px;
                margin-left: 5px;
            }

            .search-tb {
                flex: 1;
                margin-left: 10px;
                height: 20px;
                border: 2px inset #464748;
                font-family: 'terminus';
                background-color: white;
                color: black;
            }

            .opt-bar {
                width: calc(100% - 10px);
                height: 30px;
                margin: 0 5px 5px 5px;
                border: 1.5px solid #1f1f1f;
                border-top: none;
                align-items: center;
                display: flex;
            }

            .opt-btn {
                background-color: transparent;
                font-family: 'unifont';
                color: white;
                margin-left: 5px;
                margin-right: 2.5px;
                border: none;
                font-size: 15px;
            }

            .nav-button {
                height: 25px;
                width: 25px;
                border: 2px outset #1f1f1f;
                background-color: #272727;
                margin-left: 5px;
                color: white;
                font-family: 'spleen-bold';
            }

            .nav-button:active {
                border: 2px inset #1f1f1f;
            }

            .nav-button:hover {
                background-color: #3f3f3f
            }

            .nav-dirs {
                width: 20%;
                background-color: #272727;
                border: 2px outset #1f1f1f;
                padding: 10px;
                box-sizing: border-box;
                overflow-y: auto;
                margin-right: 5px;
            }

            .nav-files {
                flex: 1;
                background-color: #272727;
                border: 2px outset #1f1f1f;
                padding: 10px;
                box-sizing: border-box;
                overflow-y: auto;
            }

            .dir-item, .file-item {
                display: flex;
                align-items: center;
                padding: 5px;
                font-size: 16px;
                margin: 2px 0;
                cursor: pointer;
            }

            .dir-item:hover, .file-item:hover {
                background-color: #3f3f3f;
            }

            .dir-item.selected, .file-item.selected {
                background-color: #6363b1;
            }

            .dir-icon, .file-icon {
                margin-right: 8px;
                font-family: 'unifont';
                font-size: 12px;
            }

            .file-info {
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex: 1;
            }

            .file-size {
                font-size: 12px;
                color: #aaa;
                margin-left: 10px;
            }

            .special-dir {
                color: #ffeb3b;
            }

            .breadcrumb {
                font-size: 14px;
                color: #aaa;
                margin: 5px 10px;
            }

            .breadcrumb a {
                color: white;
                text-decoration: none;
            }

            .breadcrumb a:hover {
                text-decoration: underline;
            }
        </style>
    </head>
    <body>
        <div class="header-sec">
            <div class="selector-bar">
                <button class="selector-btn" onclick="FileManager.showFileMenu()">File</button>
                <button class="selector-btn" onclick="FileManager.openFile()">Open</button>
                <button class="selector-btn" onclick="FileManager.createNew()">New</button>
                <div class="divider"></div>
                <button class="selector-btn" onclick="FileManager.renameSelected()">Rename</button>
            </div>
        </div>
        <div class="opt-bar">
            <button class="nav-button" onclick="FileManager.navBack()"><</button>
            <button class="nav-button" onclick="FileManager.navUp()">></button>
            <p style="font-family: 'unifont'; margin-left: 10px; font-size: 15px;">Location:</p>
            <input class="search-tb" id="location-input" onkeypress="if(event.key === 'Enter') FileManager.navigateToPath(this.value)"></input>
        </div>
        <div class="breadcrumb" id="breadcrumb"></div>
        <div class="main-content">
            <div class="nav-dirs" id="nav-dirs">

            </div>
            <div class="nav-files" id="nav-files">

            </div>
        </div>
    </body>
    <script src="../js/filesystem.js"></script>
    <script>
        class FileManagerUI {
            constructor() {
                this.filesystem = new SkylineFilesystem();
                this.selectedItem = null;
                this.init();
            }

            init() {
                this.filesystem.on('onDirectoryChange', (path) => this.onDirectoryChange(path));
                this.filesystem.on('onFileSystemUpdate', () => this.refresh());

                this.currentDirEl = document.getElementById('current-directory');
                this.currentPath = this.filesystem.getCurrentPath();

                this.refresh();

                const locationInput = document.getElementById('location-input');
                locationInput.addEventListener('input', (e) => {
                    if (e.target.value === '') {
                        this.refresh();
                    }
                });
            }

            refresh() {
                this.updateLocationBar();
                this.updateBreadcrumb();
                this.populateDirectories();
                this.populateFiles();
                this.selectedItem = null;
            }

            onDirectoryChange(path) {
                this.refresh();
            }

            updateLocationBar() {
                document.getElementById('location-input').value = this.filesystem.getCurrentPath();
            }

            updateBreadcrumb() {
                const breadcrumbs = this.filesystem.getPathBreadcrumbs();
                const breadcrumbsEl = document.getElementById('breadcrumb');

                breadcrumbsEl.innerHTML = breadcrumbs.map((crumb, index) => {
                    if (index === breadcrumbs.length - 1) {
                        return crumb.name;
                    } else {
                        return `<a href="#" onclick="FileManager.navigateTo('${crumb.path}')">${crumb.name}</a>`;
                    }
                }).join(' / ');
            }

            populateDirectories() {
                const { directories } = this.filesystem.getCurrentDirContents();
                const dirsContainer = document.getElementById('nav-dirs');

                dirsContainer.innerHTML = '';

                // this fixes directories not showing when going to a directory:
                if (this.filesystem.getCurrentPath() !== '/') {
                    const parentEl = document.createElement('div');
                    parentEl.className = 'dir-item';
                    parentEl.innerHTML = `
                        <span class="dir-icon">üìÅ</span>
                        <span>.. (parent directory)</span>
                    `;
                    parentEl.ondblclick = () => this.filesystem.navUp();
                    dirsContainer.appendChild(parentEl);
                }

                directories.forEach(dir => {
                    const dirEl = document.createElement('div');
                    dirEl.className = 'dir-item';
                    if (dir.special) {
                        dirEl.classList.add('special-dir');
                    }

                    dirEl.innerHTML = `
                        <span class="dir-icon">üìÅ</span>
                        <span>${dir.name}</span>
                        ${dir.description ? `<div style="font-size: 12px; color: #888; margin-top: 2px;">${dir.description}</div>` : ''}
                        `;

                        let clickTimeout;
                        
                        dirEl.onclick = () => {
                            clearTimeout(clickTimeout);
                            clickTimeout = setTimeout(() => {
                                this.selectItem(dirEl, 'directory', dir.name);
                            }, 250);
                        };

                        dirEl.ondblclick = () => {
                            clearTimeout(clickTimeout);
                            const newPath = this.navigateTo(this.filesystem.joinPaths(this.filesystem.getCurrentPath(), dir.name));
                            this.navigateTo(newPath);
                        };

                        dirsContainer.appendChild(dirEl);
                });
            }

            

            populateFiles() {
                const { files } = this.filesystem.getCurrentDirContents();
                const filesContainer = document.getElementById('nav-files');

                filesContainer.innerHTML = '';

                files.forEach(file => {
                    const fileEl = document.createElement('div');
                    fileEl.className = 'file-item';
                    
                    const icon = this.getFileIcon(file.type);
                    const sizeStr = this.formatFileSize(file.size);

                    fileEl.innerHTML = `
                        <span class="file-icon">${icon}</span>
                        <div class="file-info">
                            <span>${file.name}</span>
                            <span class="file-size">${sizeStr}</span>
                        </div>
                    `;

                    fileEl.onclick = () => {
                        this.selectItem(fileEl, 'file', file.name);
                    }

                    fileEl.ondblclick = () => {
                        this.openFile(file.name);
                    }

                    filesContainer.appendChild(fileEl);
                });
            }

            // sorry i couldnt find any icon libraries that fit my style and idk how to make some so i decided to use emojis lol sorry
            getFileIcon(type) {
                const icons = {
                    'text': 'üìÑ',
                    'javascript': 'üìú',
                    'html': 'üåê',
                    'stylesheet': 'üé®',
                    'json': 'üìã',
                    'disk-image': 'üíø',
                    'executable': '‚öôÔ∏è',
                    'binary': 'üîß',
                    'unknown': 'üìÑ'
                };
                return icons[type] || icons['unknown'];
            }

            formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1048576) return (bytes/1024).toFixed(1) + ' KB';
                return (bytes / 1048576).toFixed(1) + ' MB';
            }

            selectItem(element, type, name) {
                document.querySelectorAll('.dir-item.selected, .file-item.selected').forEach(el => {
                    el.classList.remove('selected');
                });

                element.classList.add('selected');
                this.selectedItem = { type, name };
            }

            navigateTo(path) {
                this.filesystem.navigateTo(path);
            }

            navigateToPath(path) {
                if (this.filesystem.navigateTo(path)){
                    this.refresh();
                } else {
                    alert('Path is invalid (:sob:): ' + path);
                    document.getElementById('.location-input').value = this.filesystem.getCurrentPath();
                }
            }

            // HelloWorld(print)

            navBack() {
                this.navUp();
            }

            navUp() {
                this.filesystem.navUp();
            }   

            createNew() {
                const type = prompt('Create new (file/folder):');
                if (!type) return;

                const name = prompt(`Enter ${type} name: `);
                if (!name) return;

                if (type.toLowerCase() === 'folder' || type.toLowerCase() === 'directory') {
                    if (this.filesystem.createDirectory(name)) {
                        this.refresh();
                    } else {
                        alert('Oh noes! Failed to create the directory. (maybe it already exists?)');
                    }
                } else {
                    if (this.filesystem.createFile(name, '')) {
                        this.refresh();
                    } else {
                        alert('Oh noes! Failed to create the file. (maybe it already exists?)');
                    }
                }
            }

            openFile(fileName = null) {
                const name = fileName || (this.selectedItem?.type === 'file' ? this.selectedItem.name : null);
                if (!name) {
                    alert('SELECT A FILE TO OPEN!!!111!!1!!!!');
                    return;
                }
                
                // this is for the upcoming text editor, content will be added its up and coming dw
                const content = this.filesystem.getFileContent(name);
                if (content !== null) {
                    // placeholder for upcoming TE
                } else {
                    alert("Oh noes! Could not open file: " + name);
                }
            }

            renameSelected() {
                if (!this.selectedItem) {
                    alert('SELECT AN ITEM TO RENAME!!!!!11!!!!!11');
                    return;
                }

                const newName = prompt(`Enter a new name for ${this.selectedItem.name}:`);
                if (!newName) return;

                if (this.filesystem.renameItem(this.selectedItem.name, newName)) {
                    this.refresh();
                } else {
                    alert("Oh noes! Failed to rename the item. That name might already exist - try something unique.");
                }
            }

            deleteSelected() {
                if (!this.selectedItem) {
                    alert('SELECT AN ITEM TO DELETE!!11!!!1!1');
                    return;
                }

                if (confirm(`Are you sure you want to delete ${this.selectedItem.name}?`)) {
                    if (this.filesystem.deleteItem(this.selectedItem.name)) {
                        this.refresh();
                    } else {
                        alert('Oh noes! Failed to delete this file.')
                    }
                }
            }

            showFileMenu() {
                const menu = [
                    'New File/Folder',
                    'Open',
                    'Rename',
                    'Delete',
                    'Properties'
                ];
                
                const choice = prompt('File menu:\n' + menu.map((item, i) => `${i+1}. ${item}`).join('\n') + '\n\nEnter choice (1-5):');
                const choiceNum = parseInt(choice);

                switch(choiceNum) {
                    case 1:
                        this.createNew();
                        break;
                    case 2:
                        this.openFile();
                        break;
                    case 3:
                        this.renameSelected();
                        break;
                    case 4:
                        this.deleteSelected();
                        break;
                    case 5:
                        this.showProperties();
                        break;
                }
            }

            showProperties() {
                if (!this.selectedItem) {
                    alert("SELECT ITEM TO VIEW PROPERTIES!!!!!!1111111!11!");
                    return;
                }

                const path = this.filesystem.joinPaths(this.filesystem.getCurrentPath(), this.selectedItem.name);
                const item = this.filesystem.getItemAtPath(path);

                if (item) {
                    let info = `Name: ${item.name}\n`;
                    info += `Type: ${item.type}\n`;
                    if (item.type === 'file') {
                        info += `Size: ${this.formatFileSize(item.size)}\n`;
                        info += `Modified: ${item.modified ? item.modified.toLocaleString() : 'Unknown'}\n`;
                    }
                    info += `Path: ${path}`;

                    alert('Properties:\n\n' + info);
                }
            }

            search() {
                const query = document.getElementById('location-input').value;
                if (!query) return;

                const results = this.filesystem.search(query);

                if (results.length === 0) {
                    alert("Oh noes! No results for: " + query);
                    return;
                }

                const filesContainer = document.getElementById('nav-files');
                filesContainer.innerHTML = '<h3 style="color: white;">Search results:</h3>';

                results.forEach(result => {
                    const resultEl = document.createElement('div');
                    resultEl.className = result.type === 'directory' ? 'dir-item' : 'file-item';

                    const icon = result.type === 'directory' ? 'üìÅ' : this.getFileIcon('unknown');

                    resultEl.innerHTML = `
                        <span class="${result.type === 'directory' ? 'dir-icon' : 'file-icon'}">${icon}</span>
                        <div class="file-info">
                            <span>${result.name}</span>
                            <span class="file-size" style="font-size: 10px;">${result.path}</span>
                        </div>
                    `;

                    resultEl.onclick = () => {
                        const parentPath = result.path.substring(0, result.path.lastIndexOf('/')) || '/';
                        this.filesystem.navigateTo(parentPath);
                    };

                    filesContainer.appendChild(resultEl);
                });

                document.getElementById('nav-dirs').innerHTML = '<div style="color: #888; padding: 10px;">Search Mode</div>';
            }
        }

        let FileManager;
        document.addEventListener('DOMContentLoaded', () => {
            FileManager = new FileManagerUI();

            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey) {
                    switch(e.key) {
                        case 'n':
                            e.preventDefault();
                            FileManager.createNew();
                            break;
                        case 'o':
                            e.preventDefault();
                            FileManager.openFile();
                            break;
                        case 'f':
                            e.preventDefault();
                            document.getElementById('location-input').focus();
                            break;
                    }
                } else if (e.key === 'Delete' && FileManager.selectedItem) {
                    e.preventDefault();
                    FileManager.deleteSelected();
                }
            });
        });

        // sudo apt install opsec (pro hacker language frfr)
    </script>
</html> 